# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PhiLLM is a Slack AI Twin application that creates AI personas from user message history. The system joins Slack channels, collects messages from specific users, generates embeddings using OpenAI, stores them in Redis as vectors, and creates AI twins that mimic user communication styles.

## Development Commands

### Environment Setup
```bash
# Install dependencies (uses uv for package management)
uv sync --all-extras

# Start Redis locally for development
docker run -d -p 6379:6379 redis/redis-stack:latest
```

### Running the Application
```bash
# Run in development mode
uv run python -m phillm.main

# Run with Docker
docker build -t phillm .
docker run -p 3000:3000 phillm
```

### Code Quality
```bash
# Format code
uv run black phillm/ tests/

# Lint code
uv run ruff check phillm/ tests/

# Type checking
uv run mypy phillm/

# Run tests
uv run pytest
uv run pytest tests/test_specific.py  # Single test file
```

## Architecture

### Core Components
- **phillm/slack/**: Slack Bot integration and event handlers using slack-bolt
- **phillm/ai/**: OpenAI integration for embeddings and AI twin generation
- **phillm/vector/**: Redis vector database operations and similarity search
- **phillm/api/**: FastAPI REST endpoints for external interaction

### Data Flow
1. Slack bot joins channels and collects user messages
2. Messages are processed and sent to OpenAI for embedding generation
3. Embeddings are stored in Redis with vector search capabilities
4. AI twin responses are generated by finding similar historical messages and using them as context for OpenAI completions

### Key Dependencies
- FastAPI for the web framework and API layer
- slack-bolt for Slack integration
- OpenAI API for embeddings (text-embedding-3-large) and completions
- Redis Stack for vector storage and similarity search
- uv for Python package management

### Environment Configuration
Copy `.env.example` to `.env` and configure:
- Slack bot token and signing secret
- OpenAI API key
- Redis connection details
- Honeycomb API key for observability
- Set `OTEL_INSTRUMENTATION_GENAI_CAPTURE_MESSAGE_CONTENT=true` to capture full OpenAI prompts and responses in telemetry

## Development Practices

- Practice Test-Driven Development. Write tests for functionality and features first, then iterate until tests are passing.